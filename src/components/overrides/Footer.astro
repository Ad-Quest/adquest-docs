---
import { Icon } from "@astrojs/starlight/components";
import type { StarlightIcon } from "@astrojs/starlight/types";
import EditLink from "@astrojs/starlight/components/EditLink.astro";
import LastUpdated from "@astrojs/starlight/components/LastUpdated.astro";
import Pagination from "@astrojs/starlight/components/Pagination.astro";

import OneTrust from "../OneTrust.astro";
import FeedbackPrompt from "../FeedbackPrompt.tsx";

const groups = Object.entries({
	Ресурсы: [
		{ text: "Панель управления", href: "https://dashboard.ad-quest.ru" },
		{ text: "API", href: "/adquest-widget/api/" },
		{ text: "Документация", href: "/adquest-widget/" },
	],
	Поддержка: [
		{ text: "Email", href: "mailto:support@ad-quest.ru" },
		{ text: "Решение проблем", href: "/adquest-widget/gotchas/" },
	],
	Сообщество: [
		{
			text: "GitHub",
			href: "https://github.com/adquest",
			icon: "github",
		},
	],
});

const links = Object.entries({
	"Политика конфиденциальности": "https://ad-quest.ru/privacy/",
	"Условия использования": "https://ad-quest.ru/terms/",
});

const homepage = Astro.locals.starlightRoute.entry.id === "";
const splash = Astro.locals.starlightRoute.entry.data.template === "splash";
const showFeedback = Astro.locals.starlightRoute.entry.data.feedback;

let isProduction = false;

if (
	import.meta.env.CF_PAGES_BRANCH === "production" ||
	import.meta.env.GITHUB_REF_NAME === "production"
) {
	isProduction = true;
}
---

<footer class="sl-flex">
	<div class="custom-footer-section w-full">
		<div class="grid grid-cols-2 gap-8 pt-6 pb-10 lg:grid-cols-3">
			{
				groups.map(([title, items]) => (
					<ul class="flex w-full list-none flex-col gap-3 pl-0">
						<li class="text-xs leading-5">
							<strong>{title}</strong>
						</li>
						{items.map((link) => (
							<li class="text-sm">
								<a
									href={link.href}
									class="flex items-center gap-2 text-black! no-underline"
								>
									{"icon" in link && <Icon name={link.icon as StarlightIcon} />}
									{link.text}
								</a>
							</li>
						))}
					</ul>
				))
			}
		</div>
		<div>
			<ul
				class="text-cl1-gray-4! dark:text-cl1-gray-7! flex list-inside flex-wrap items-center justify-center gap-3 gap-y-4 pl-0 text-xs"
			>
				<li class="list-none">© 2026 AdQuest</li>
				{
					links.map(([text, href]) => (
						<li>
							<a
								href={href}
								class="text-cl1-gray-4! dark:text-cl1-gray-7! no-underline"
							>
								{text}
							</a>
						</li>
					))
				}
				{
					isProduction && (
						<li>
							<OneTrust />
						</li>
					)
				}
			</ul>
		</div>
	</div>

	{
		!splash && (
			<div class="starlight-footer-section">
				<Pagination />
				<div class="meta sl-flex">
					<EditLink />
					<LastUpdated />
				</div>
			</div>
		)
	}

	{
		!homepage && showFeedback && (
			<div class="feedback-prompt">
				<FeedbackPrompt client:idle />
			</div>
		)
	}
</footer>

<style>
	footer {
		flex-direction: column-reverse !important;
	}

	.feedback-prompt {
		padding-top: 2rem;
		margin-bottom: 2rem;

		h2 {
			color: var(--sl-color-white);
			font-size: var(--sl-text-h5);
			font-weight: 600;
			line-height: var(--sl-line-height-headings);
			margin-bottom: 0.5rem;
		}
	}

	.starlight-footer-section {
		padding-bottom: 2rem;

		.meta {
			margin-top: 2em;
			gap: 0.75rem 3rem;
			justify-content: space-between;
			flex-wrap: wrap;
			font-size: var(--sl-text-sm);
			color: var(--sl-color-gray-3);
		}
	}

	.custom-footer-section {
		padding-top: 2rem;
	}

	@media (min-width: 72rem) {
		html[data-has-toc] {
			.feedback-prompt {
				display: none;
			}
		}
	}
</style>
