---
pcx_content_type: how-to
title: Run endpoint health checks (beta)
sidebar:
  badge:
    text: Beta
  order: 1
  label: Run endpoint health checks

---

import { CURL, Render, DashButton } from '~/components';

Magic Transit uses endpoint health checks to determine the overall health of your [inter-network connections](/magic-transit/reference/gre-ipsec-tunnels/). Probes originate from Cloudflare infrastructure, outside customer network namespaces, and target IP addresses deep within your network, beyond the tunnel-terminating border router. These "long distance" probes are purely diagnostic.

When choosing which endpoint IP addresses to monitor with health checks, use these guidelines:

- Provide one IP address for each of the prefixes Cloudflare advertises.
- Redundant IPs routed through the same ISP (Internet Service Provider) and infrastructure are not necessary but are useful when troubleshooting.

Cloudflare pings health check IPs from within the [published Cloudflare IP range](https://www.cloudflare.com/ips/), which is also available through the [Cloudflare API](/api/resources/ips/methods/list/).

When configuring an endpoint health check for an IP prefix, select an IP address within the range of that IP prefix. Refer to the table for an example of an endpoint health check configuration.

| Prefix            | Endpoint IP address |
| ----------------- | ------------------- |
| `103.21.244.0/24` | `103.21.244.100`    |
| `103.21.245.0/24` | `103.21.245.100`    |

Refer to [Tunnel health checks](/magic-transit/reference/tunnel-health-checks/) for more information.

## Configure endpoint health checks (beta)

You can only configure endpoint health checks through the Cloudflare API. They are not available in the dashboard. Currently, configuring health checks is a beta feature.

Refer to the [API documentation](/api/resources/diagnostics/subresources/endpoint-healthchecks/) to learn how to create, list, and delete endpoint health checks. The following example creates a new endpoint health check.

<Render file="account-id-api-key" product="networking-services" />

<CURL
  url="https://api.cloudflare.com/client/v4/accounts/account_id/diagnostics/endpoint-healthcheck"
  method="POST"
  json={{
    "check_type": "icmp",
    "endpoint": "8.31.160.1",
    "name": "Datacenter 1 - primary"
  }}
/>

```json output
{
    "result": {
        "id": "<HEALTH_CHECK_ID>",
        "check_type": "icmp",
        "endpoint": "8.31.160.1",
        "name": "Datacenter 1 - primary"
    },
    "success": true,
    "errors": [],
    "messages": []
}
```

## Query endpoint health checks with GraphQL

<Render file="graphql/query-magic-transit-endpoint-health-checks" product="networking-services" />

## Configure alerts for endpoint health checks

You can set up alerts to be notified when the state of your endpoint's health is below a threshold defined by you.

1. Make a `GET` request to get a list of IDs for all of the endpoint health checks configured:

<CURL
  url="https://api.cloudflare.com/client/v4/accounts/account_id/diagnostics/endpoint-healthcheck"
  method="GET"
/>

```json output
{
    "result": [
        {
            "id": "<HEALTH_CHECK_ID>",
            "check_type": "icmp",
            "endpoint": "8.31.160.1",
            "name": "Datacenter 1 - primary"
        }
    ],
    "success": true,
    "errors": [],
    "messages": []
}
```

2. Take note of the `id` value for the endpoint you want to get alerts for.
3. In the Cloudflare dashboard, go to the **Notifications** page.

<DashButton url="/?to=/:account/notifications" />

4. Select **Add**.
5. From the drop-down menu, select *Magic Transit*.
6. Select **Magic Endpoint Health Check Alert**.
7. Provide a name for your new notification and optionally provide a description.
8. In the *Service Level Objective (SLO)* drop-down menu, select the SLO threshold for your notification. The SLO defines the percentage of endpoint health checks that must pass. If the number of passing endpoint health checks falls below the SLO, Cloudflare generates an alert:
	- **High** - 99%
	- **Medium** - 98%
	- **Low** - 97%
9. In the drop-down menu below SLOs, select the `id` value that matches the `id` you got through the API in step 1. This `id` should match the endpoint health check you want to get notifications for.
10. Select your preferred notification method (such as email or webhooks).
11. Select **Save**.

You will now receive notifications through your preferred method whenever the SLO for your endpoint health checks falls below your chosen threshold.
