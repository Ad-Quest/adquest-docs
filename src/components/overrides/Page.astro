---
import Default from "@astrojs/starlight/components/Page.astro";

import { generateDescription, generateTableOfContents } from "~/util/props";

const props = Astro.locals.starlightRoute;
const data = props.entry.data;

const html = await Astro.slots.render("default");

if (props.toc) {
	props.toc.items = await generateTableOfContents(html);
}

// Используем стандартный sidebar из Starlight
// Убрали кастомную логику getSidebar, которая требует коллекцию directory

if (data.description) {
	data.description = await generateDescription({
		markdown: data.description,
	});
} else {
	data.description = await generateDescription({ html });
}

if (data.reviewed) {
	data.lastUpdated = undefined;
}
---

<Default set:html={html} />

<style>
	html:not([data-has-toc]) {
		--sl-content-width: 67.5rem;
	}
</style>
