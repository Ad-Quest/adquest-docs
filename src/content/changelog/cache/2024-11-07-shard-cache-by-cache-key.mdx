---
title: Shard cache using custom cache key values
description: Enterprise customers can now shard cache using previously restricted accept*, referer, and user-agent headers.
products:
  - cache
date: 2024-11-07
---

Enterprise customers can now optimize cache hit ratios for content that varies by device, language, or referrer by **sharding cache** using up to ten values from previously restricted headers with [custom cache keys](/cache/how-to/cache-keys/).

## How it works

When configuring [custom cache keys](/cache/how-to/cache-keys/), you can now include values from these headers to create distinct cache entries:

- **`accept*` headers** (for example, `accept`, `accept-encoding`, `accept-language`): Serve different cached versions based on content negotiation.
- **`referer` header**: Cache content differently based on the referring page or site.
- **`user-agent` header**: Maintain separate caches for different browsers, devices, or bots.

## When to use cache sharding

- Content varies significantly by device type (mobile vs desktop).
- Different language or encoding preferences require distinct responses.
- Referrer-specific content optimization is needed.

## Example configuration

```json
{
  "cache_key": {
    "custom_key": {
      "header": {
        "include": ["accept-language", "user-agent"],
        "check_presence": ["referer"]
      }
    }
  }
}
```

This configuration creates separate cache entries based on the `accept-language` and `user-agent` headers, while also considering whether the `referer` header is present.

## Get started

To get started, refer to the [custom cache keys documentation](/cache/how-to/cache-keys/).

:::note

While cache sharding can improve hit ratios for specific use cases, overly sharding your cache can reduce overall cache efficiency and negatively impact performance. Carefully evaluate whether sharding benefits your specific traffic patterns.

:::
