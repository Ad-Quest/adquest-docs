---
{}
---

import { Render, PackageManagers } from "~/components";

Install the [mysql2](https://github.com/sidorares/node-mysql2) driver:

<PackageManagers pkg="mysql2@>3.13.0" />

:::note
`mysql2` v3.13.0 or later is required
:::

Add the required Node.js compatibility flags and Hyperdrive binding to your `wrangler.jsonc` file:

<Render file="hyperdrive-node-compatibility-requirement" product="hyperdrive" />

Create a new `connection` instance and pass the Hyperdrive parameters:

```ts
// mysql2 v3.13.0 or later is required
import { createConnection } from "mysql2/promise";

export default {
	async fetch(request, env, ctx): Promise<Response> {
		// Create a new connection on each request. Hyperdrive maintains the underlying
		// database connection pool, so creating a new connection is fast.
		const connection = await createConnection({
			host: env.HYPERDRIVE.host,
			user: env.HYPERDRIVE.user,
			password: env.HYPERDRIVE.password,
			database: env.HYPERDRIVE.database,
			port: env.HYPERDRIVE.port,

			// Required to enable mysql2 compatibility for Workers
			disableEval: true,
		});

		try {
			// Sample query
			const [results, fields] = await connection.query("SHOW tables;");

			// Clean up the client after the response is returned.
			// Hyperdrive keeps the underlying database connection open in its
			// pool and reuses it for future requests.
			ctx.waitUntil(connection.end());

			// Return result rows as JSON
			return Response.json({ results, fields });
		} catch (e) {
			console.error(e);
			return Response.json(
				{ error: e instanceof Error ? e.message : e },
				{ status: 500 },
			);
		}
	},
} satisfies ExportedHandler<Env>;
```

:::note

The minimum version of `mysql2` required for Hyperdrive is `3.13.0`.

:::
